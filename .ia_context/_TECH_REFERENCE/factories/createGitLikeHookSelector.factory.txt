/* eslint-disable @typescript-eslint/no-explicit-any */
import type {
  GitLikeStore,
  GitLikeState,
} from '../create-git-like-zustand-store';

/**
 * Builds a small set of typed selector hooks for a git-like Zustand store.
 * All hooks subscribe via `useStore(selector, equalityFn?)`.
 */
export function createGitLikeHookSelectorFactory<T>(useStore: GitLikeStore<T>) {
  // We cast to `any` when an equality function is provided to support projects where the store type
  // is declared without the equality overload (accepting only 0-1 arguments).

  /** Select from stashData with a custom selector. */
  function useSelectStashData<U>(
    selector: (stash: T) => U,
    equalityFn?: (a: U, b: U) => boolean,
  ): U {
    // We always call the hook exactly once and pass equalityFn (possibly undefined) to avoid conditional hook calls and silence the ESLint react-hooks/rules-of-hooks warning.
    return (useStore as any)(
      (s: GitLikeState<T>) => selector(s.stashData),
      equalityFn,
    );
  }

  /** Select from commitData with a custom selector. */
  function useSelectCommitData<U>(
    selector: (commit: T) => U,
    equalityFn?: (a: U, b: U) => boolean,
  ): U {
    // We always call the hook exactly once and pass equalityFn (possibly undefined) to avoid conditional hook calls and silence the ESLint react-hooks/rules-of-hooks warning.
    return (useStore as any)(
      (s: GitLikeState<T>) => selector(s.commitData),
      equalityFn,
    );
  }

  /** Subscribe to the whole stash object. */
  function useStashData(equalityFn?: (a: T, b: T) => boolean): T {
    // We always call the hook exactly once and pass equalityFn (possibly undefined) to avoid conditional hook calls and silence the ESLint react-hooks/rules-of-hooks warning.
    return (useStore as any)((s: GitLikeState<T>) => s.stashData, equalityFn);
  }

  /** Subscribe to the whole commit object. */
  function useCommitData(equalityFn?: (a: T, b: T) => boolean): T {
    // We always call the hook exactly once and pass equalityFn (possibly undefined) to avoid conditional hook calls and silence the ESLint react-hooks/rules-of-hooks warning.
    return (useStore as any)((s: GitLikeState<T>) => s.commitData, equalityFn);
  }

  /** Get the stashField setter (action). */
  function useStash(): GitLikeState<T>['stash'] {
    return useStore((s) => s.stash);
  }

  /** Get the stashField function (action: key/value). */
  function useStashField(): GitLikeState<T>['stashField'] {
    return useStore((s) => s.stashField);
  }

  /** Get the commit function (action). */
  function useCommit(): GitLikeState<T>['commit'] {
    return useStore((s) => s.commit);
  }

  /** Get the discard function (action). */
  function useDiscard(): GitLikeState<T>['discard'] {
    return useStore((s) => s.discard);
  }

  /** Get the resetStash function (action). */
  function useResetStash(): GitLikeState<T>['resetStash'] {
    return useStore((s) => s.resetStash);
  }

  /** Get the resetRepo function (action). */
  function useResetRepo(): GitLikeState<T>['resetRepo'] {
    return useStore((s) => s.resetRepo);
  }

  return {
    useSelectStashData,
    useSelectCommitData,
    useStashData,
    useCommitData,
    useStash,
    useStashField,
    useCommit,
    useDiscard,
    useResetStash,
    useResetRepo,
  };
}
